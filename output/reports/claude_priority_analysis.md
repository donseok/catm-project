# 모더나이제이션 우선순위 - Claude 평가

## 구조화된 점수 (파싱용 JSON)

```json
{
  "scores": {
    "PGM001": {"business_importance": 9, "phase": 1, "reason": "MES 핵심 - 일일 생산실적 집계는 MES의 가장 기본적인 데이터 수집 기능"},
    "PGM003": {"business_importance": 9, "phase": 1, "reason": "MES 핵심 - 품질검사/판정/불량률 경보는 MES 품질관리 모듈의 중심 기능"},
    "PGM005": {"business_importance": 8, "phase": 1, "reason": "MES 핵심 - 고로 조업 데이터 수집 및 이상치 경보는 공정제어/설비감시의 핵심"},
    "PGM002": {"business_importance": 8, "phase": 2, "reason": "MES 주요 - 재고수불은 MES 자재관리 모듈이나 ERP 연계 영역에 해당"},
    "PGM004": {"business_importance": 7, "phase": 2, "reason": "MES 주요 - 계획 대비 실적 분석은 MES 생산관리 보고 기능"},
    "PGM006": {"business_importance": 7, "phase": 2, "reason": "MES 주요 - 원자재 입고/검수는 MES 자재관리와 품질관리 접점"}
  }
}
```

---

## 비즈니스 중요도 재산정

| 프로그램 | 기존 점수 | 재산정 | 근거 |
|---------|----------|--------|------|
| PGM001 | 5 | **9** | 일일 생산실적 집계는 MES의 근본 기능. 생산수량 집계 → DB2 반영 → 온라인 조회 연동 구조가 MES 실적관리 모듈과 1:1 대응. 모든 후속 분석(PGM004, PGM005)의 데이터 원천 |
| PGM003 | 5 | **9** | 품질검사 판정(합격/불량/재작업), 불량률 기반 경보, 치명불량 즉시 알림은 MES 품질관리의 핵심 루프. 재작업 3회 초과 → 불량 전환 같은 비즈니스 규칙이 MES SPC/SQC 모듈에 직결 |
| PGM005 | 5 | **8** | 고로 온도/압력/출선량 실시간 수집 및 이상치 경보(1,400~1,650°C 범위)는 MES 공정제어·설비감시 모듈의 핵심. 다만 고로 특화 로직이라 범용성은 약간 낮음 |
| PGM002 | 5 | **8** | 입출고 트랜잭션 → 재고 마스터 갱신 → 수불대장 생성 흐름은 MES 자재관리의 기본이나, ERP WMS와 경계가 겹침. 신규 품목 자동등록, 음수재고 방지 로직은 전환 시 반드시 보존 필요 |
| PGM004 | 5 | **7** | 생산계획 대비 실적 달성율 분석은 MES 보고·분석 기능. 90% 미만 미달 판정, 미달 시 생산지시 알림 등 의사결정 지원 성격. PGM001 실적 데이터에 의존 |
| PGM006 | 5 | **7** | 원자재 입고 검수(전량합격/부분합격/불합격 분기)는 MES 품질·자재 접점 기능. 부분합격 시 합격률 기반 수량 산출, 불합격 반품 처리 등 비즈니스 규칙이 풍부하나 PGM002와 유사한 자재 영역 |

> **재산정 근거 요약**: 기존 점수 5(일괄)는 비즈니스 로직 분석 전 정적 메트릭 기반이었음. Claude 분석 결과를 반영하면, 전 프로그램이 MES 핵심~주요 영역에 해당하여 7~9로 상향 조정.

---

## Phase 배정

### Phase 1 (즉시 전환, 0-3개월)

| 프로그램 | 전환 방식 | 이유 |
|---------|----------|------|
| **PGM001** | 자동 변환 | MES 실적 수집의 기반. 구조 단순(116행, 복잡도 12), DB2 UPDATE 1건. 가장 먼저 전환하여 MES 데이터 파이프라인 구축의 시작점으로 활용 |
| **PGM003** | 하이브리드 | MES 품질관리의 핵심. 판정 분기(P/F/R), 불량률 계산, 경보 발행 등 비즈니스 규칙이 복잡(179행, 복잡도 27)하여 자동 변환 후 수동 검증 필요 |
| **PGM005** | 하이브리드 | 공정제어 핵심이나 가장 복잡(235행, 복잡도 35). 2개 입력 파일 랜덤 조회, 온도 범위 경보 로직은 자동 변환 후 안전 임계값 검증이 필수 |

### Phase 2 (중기 전환, 3-6개월)

| 프로그램 | 전환 방식 | 이유 |
|---------|----------|------|
| **PGM002** | 자동 변환 | 재고수불 처리. Phase 1의 생산실적/품질 데이터가 안정된 후 재고 연동. 167행/복잡도 18로 비교적 단순하나, REWRITE(마스터 갱신)와 음수재고 방지 로직 검증 필요 |
| **PGM006** | 자동 변환 | 원자재 입고/검수. PGM002의 재고 체계가 안정된 후 원자재 입고를 연계. 검수 분기(A/P/R)와 부분합격 수량 계산은 테스트 케이스 충분히 확보 필요 |
| **PGM004** | 자동 변환 | 계획 대비 실적 분석. PGM001(실적 데이터)이 전환 완료된 후에야 의미 있음. 205행/복잡도 24이나 핵심은 달성율 산술 연산으로 자동 변환 적합 |

### Phase 3 해당 프로그램 없음
현재 6개 프로그램 모두 MES 핵심~주요 기능에 해당하여 Phase 3(6개월 이후) 배정 대상이 없음.

---

## 전환 순서 권장

```
Phase 1 (0-3개월)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  PGM001 (생산실적 집계)          ← 최우선: 모든 분석의 데이터 원천
    ↓
  PGM003 (품질검사 처리)          ← PGM001과 병렬 가능하나 ERRLOG 공유
    ↓
  PGM005 (고로 조업 데이터)       ← PGM001 안정 후 착수 권장

Phase 2 (3-6개월)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  PGM002 (재고수불 처리)          ← Phase 1 실적 데이터 안정 후
    ↓
  PGM006 (원자재 입고/검수)       ← PGM002 재고 체계 안정 후
    ↓
  PGM004 (계획 대비 실적 분석)    ← PGM001 데이터에 의존, 마지막 전환
```

**선후행 관계 상세**:

| 선행 | 후행 | 의존 이유 |
|------|------|----------|
| PGM001 | PGM004 | PGM004의 생산실적 데이터가 PGM001이 적재하는 TB_DAILY_PROD에서 파생 |
| PGM001 | PGM002 | 생산실적 집계가 안정되어야 재고 트랜잭션과의 정합성 확보 가능 |
| PGM002 | PGM006 | 원자재 입고가 재고 마스터를 갱신하므로, PGM002의 재고 체계가 먼저 안정되어야 함 |
| PGM003 | PGM005 | 둘 다 품질/공정 영역이나 직접 의존은 없음. 다만 ERRLOG 서브프로그램을 공유하므로 ERRLOG 전환을 먼저 확정해야 함 |

**공통 의존 모듈 (먼저 전환)**:
- **ERRLOG**: PGM001, PGM003, PGM004, PGM005, PGM006 모두 호출 → Phase 1 시작 전에 반드시 전환 완료
- **BFALERT**: PGM005 전용 → PGM005 전환 시 함께 처리
- **SQLCA/DCLGEN**: 모든 프로그램이 DB2 사용 → DB2 연결 계층을 공통 모듈로 먼저 구축

---

## 리스크 및 주의사항

### 높은 리스크

| 리스크 | 해당 프로그램 | 상세 |
|--------|-------------|------|
| **COMP-3 데이터 변환** | 전체 | 모든 수량/금액 필드가 COMP-3(Packed Decimal). Java/Python 전환 시 정밀도 손실 위험. 특히 PGM005의 온도값(소수 1자리)과 PGM004의 달성율(소수 2자리) |
| **VSAM → RDBMS 키 매핑** | PGM002, PGM005, PGM006 | 복합키(공장+품목+일자+순번) 구조의 VSAM KSDS를 RDB 인덱스로 전환 시 성능 저하 가능 |
| **파일 상태 코드 처리** | 전체 | COBOL FILE STATUS 기반 에러 처리를 예외(Exception) 기반으로 전환 시 누락 위험 |

### 중간 리스크

| 리스크 | 해당 프로그램 | 상세 |
|--------|-------------|------|
| **DB2 SQL 호환성** | 전체 | 호스트 변수 바인딩, SQLCODE 기반 분기를 JDBC/ORM으로 전환 시 에러 핸들링 패턴 변경 필요 |
| **PGM001 요약 레코드 불완전** | PGM001 | 3000-WRITE-SUMMARY에서 공장코드, 생산일자, 상태코드를 설정하지 않고 WRITE하는 기존 결함 → 전환 시 수정 기회 |
| **음수 재고 방지** | PGM002 | 출고 시 현재고 부족하면 ERRLOG 호출 후 에러 카운트만 증가하고 출고를 처리하지 않음 → 전환 시 이 규칙 정확히 보존 필요 |
| **부분합격 수량 계산** | PGM006 | 합격률(%) 기반으로 입고수량 중 일부만 재고 반영 → 소수점 절사/반올림 규칙 확인 필요 |

### 전환 전략 공통 권고

1. **ERRLOG 서브프로그램 우선 전환**: 6개 중 5개가 호출하므로 공통 로깅 모듈을 먼저 구축
2. **COPYBOOK → DTO/Entity 매핑 테이블 작성**: 12개 COPYBOOK의 필드를 새 시스템 엔티티에 매핑하는 사전 작업 필수
3. **DB2 테이블 스키마 유지**: 기존 DB2 테이블 구조를 최대한 유지하여 온라인 시스템과의 호환성 확보
4. **병렬 운영(Parallel Run) 기간 확보**: Phase 1 전환 후 최소 1개월간 기존 COBOL과 신규 시스템 병행 운영하여 집계 결과 일치 검증
5. **테스트 데이터 확보**: 각 프로그램의 EVALUATE 분기(정상/이상/경계값)를 모두 커버하는 테스트 케이스 사전 준비