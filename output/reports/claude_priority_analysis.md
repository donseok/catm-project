# 모더나이제이션 우선순위 - Claude 평가

## 구조화된 점수 (파싱용 JSON)

```json
{
  "scores": {
    "PGM001": {"business_importance": 8, "phase": 1, "reason": "MES 핵심인 일일 생산실적 집계 프로그램으로 생산수량 추적의 기반"},
    "PGM002": {"business_importance": 7, "phase": 1, "reason": "재고 마스터 갱신 및 수불대장 생성으로 MES 자재/재고 관리의 핵심"}
  }
}
```

## 비즈니스 중요도 재산정

| 프로그램 | 기존 점수 | 재산정 | 근거 |
|---------|----------|--------|------|
| PGM001 | 5 | **8** | 생산라인별 실적 트랜잭션을 집계하여 DB2에 반영하는 일일 생산실적 배치로, MES의 생산실적 관리(Production Tracking) 핵심 기능에 해당. 생산수량·건수·오류건수 집계는 MES 대시보드와 KPI의 기초 데이터 |
| PGM002 | 5 | **7** | 입출고 트랜잭션 기반 재고 마스터 갱신 및 수불대장 생성 프로그램. MES의 자재관리(Material Management) 주요 기능으로, 실시간 재고 가시성 확보에 필수. 다만 생산실적보다는 한 단계 후행하는 보조 핵심 기능 |

## Phase 배정

### Phase 1 (즉시 전환, 0-3개월)

**PGM001 — 일일 생산실적 집계**
- MES 핵심 중의 핵심. 생산실적 데이터가 없으면 MES의 모든 후속 분석·보고가 불가
- 구조가 단순 (116 라인, 복잡도 12): 순차 읽기 → 집계 → 파일/DB2 출력의 직선적 흐름
- DB2 연동이 단일 UPDATE문으로 단순하여 전환 리스크 낮음
- 전환 용이도 점수 7로 자동 변환 가능

**PGM002 — 재고 관리/수불대장**
- PGM001과 동일 Phase에 배정하되, PGM001 전환 완료 후 착수
- 167 라인, 복잡도 18로 PGM001보다 높지만 여전히 관리 가능 범위
- VSAM KSDS 랜덤 I/O + 3개 파일 동시 처리로 전환 시 주의 필요
- 재고 데이터는 생산실적과 연계되어 초기 MES 구축 시 함께 필요

### Phase 2, Phase 3
- 현재 분석 대상 2개 프로그램은 모두 Phase 1에 해당. 추가 프로그램 분석 시 배정 예정

## 전환 순서 권장

```
PGM001 (생산실적 집계)  ──→  PGM002 (재고 관리)
        [1순위]                    [2순위]
```

**선후행 근거:**

1. **PGM001 먼저**: 생산실적 데이터가 MES의 근간. 생산수량이 확보되어야 재고 입출고 검증도 가능
2. **PGM002 후행**: 재고 갱신 로직에 PGM001이 생성하는 생산실적 데이터를 참조하는 업무 흐름 존재. 또한 PGM002는 ERRLOG 외부 프로그램 호출(CALL 4건)이 있어 관련 서브프로그램 전환도 함께 고려 필요
3. **공유 인프라**: 둘 다 DB2를 사용하므로 DB2 접속 미들웨어(JDBC/커넥션풀) 구축을 PGM001 전환 시 완료하면 PGM002에서 재사용 가능

## 전환 전략

### PGM001 — 자동 변환 권장

| 항목 | 내용 |
|------|------|
| 전환 방식 | **자동 변환** (COBOL → Java/Python 배치) |
| 근거 | 직선적 제어 흐름, 단순 EVALUATE 분기, 단일 DB2 UPDATE |
| 주의사항 | VSAM KSDS → RDBMS 테이블 전환 시 키 구조(공장+라인+일자+순번) 보존 필요 |
| COPYBOOK 처리 | CPYTRANS, CPYSMRY → DTO/Entity 클래스로 1:1 매핑 |
| DB2 전환 | `EXEC SQL UPDATE` → JPA/MyBatis 매핑. CURRENT DATE 함수 호환 확인 |
| 테스트 포인트 | 수량 양수/영/음수 3개 분기 경로, EOF 처리, 파일 오픈 실패 경로 |

### PGM002 — 하이브리드 권장 (자동 변환 + 수동 검증)

| 항목 | 내용 |
|------|------|
| 전환 방식 | **하이브리드** (자동 변환 후 수동 리뷰) |
| 근거 | 3개 파일 동시 운용, VSAM 랜덤 I/O, 신규 품목 자동 등록 로직에 비즈니스 리스크 존재 |
| 주의사항 ① | **신규 품목 등록 버그**: 출고 트랜잭션으로 신규 품목이 등록되면 음수 재고 발생 가능 → 전환 시 비즈니스 로직 보정 필요 |
| 주의사항 ② | **수불대장 파일 오픈 미검증**: WS-FILE-STATUS3 체크 누락 → 전환 시 에러 핸들링 추가 |
| 주의사항 ③ | VSAM KSDS 랜덤 READ/REWRITE → RDBMS SELECT FOR UPDATE 전환 시 동시성 제어 설계 |
| COPYBOOK 처리 | CPYINVTR, CPYINVMS, CPYLEDGR → 3개 Entity 클래스. 필드 수가 많아 매핑 정확도 검증 필수 |
| 테스트 포인트 | 입고/출고 분기, 신규 품목 등록, 마스터 미존재 케이스, 재고 음수 방지, DB2 INSERT 중복 키 처리 |

## 리스크 및 주의사항

### 공통 리스크

| 리스크 | 심각도 | 설명 | 대응 |
|--------|--------|------|------|
| VSAM → RDBMS 전환 | 중 | VSAM KSDS의 키 순서 접근 패턴이 RDBMS에서 성능 차이 발생 가능 | 인덱스 설계 시 기존 VSAM 키 구조 반영, 성능 테스트 필수 |
| COPYBOOK 매핑 오류 | 중 | COMP-3 (패킹 십진수), 88 레벨 조건명 등 COBOL 고유 데이터 타입 전환 시 정밀도 손실 | 필드별 데이터 타입 매핑 테이블 작성, 경계값 테스트 |
| 배치 윈도우 변경 | 하 | 메인프레임 배치 스케줄 → 신규 스케줄러 전환 시 실행 순서 및 시간대 차이 | 기존 JCL 스케줄 분석 후 신규 스케줄러에 동일 순서 적용 |
| 외부 프로그램 의존성 | 중 | PGM002의 ERRLOG, INVVAL, INVHIST, INVNOTF 호출 → 해당 프로그램 미전환 시 연동 불가 | 서브프로그램 전환 범위 사전 확정, 임시 스텁 프로그램으로 병렬 개발 |

### PGM002 고유 리스크

| 리스크 | 심각도 | 설명 |
|--------|--------|------|
| 신규 품목 등록 로직 결함 | **상** | 출고 트랜잭션으로도 신규 품목이 등록되어 음수 재고 발생 가능. 전환 시 반드시 입고('I') 여부 검증 로직 추가 |
| 수불대장 파일 오픈 미검증 | 중 | 수불대장 파일 오픈 실패 시 무시되고 계속 진행 → 데이터 유실. 전환 시 에러 핸들링 보강 |
| 재고 음수 미방지 | 중 | 출고 시 현재고 부족 여부를 검증하지 않음 → 음수 재고 발생 가능. MES 전환 시 재고 부족 체크 로직 추가 권장 |